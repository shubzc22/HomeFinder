<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Auto Jitsi Meeting</title>
  <style>
    html,body,#container{height:100%;margin:0;padding:0;}
    #container { position: relative; }
  </style>

  <!-- API for controlling camera/mic -->
  <script src="https://8x8.vc/_jitsi_external_api/external_api.js"></script>

  <script>
    function generateRoomID(length = 12) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let result = "";
      for (let i = 0; i < length; i++)
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      return result;
    }

    window.onload = () => {
      const room = generateRoomID(10);

      const domain = "meeting.experte.de";
      const options = {
        roomName: room,
        parentNode: document.querySelector('#container'),
        configOverwrite: {
          startWithAudioMuted: false,
          startWithVideoMuted: false
        },
        interfaceConfigOverwrite: {
          SHOW_JITSI_WATERMARK: false,
          SHOW_WATERMARK_FOR_GUESTS: false
        }
      };

      const api = new JitsiMeetExternalAPI(domain, options);

      // once meeting is ready, turn mic/cam on
      api.addEventListener("videoConferenceJoined", () => {
        api.executeCommand("toggleAudio"); // ON mic if not already
        api.executeCommand("toggleVideo"); // ON cam if not already

        // switch to back camera
        setTimeout(async () => {
          try {
            const devices = await api.getAvailableDevices();
            const videoDevices = devices.videoInput || [];

            const backCam = videoDevices.find(d =>
              d.label.toLowerCase().includes("back")
              || d.label.toLowerCase().includes("rear")
            );

            if (backCam) {
              api.setVideoInputDevice(backCam.deviceId);
            }
          } catch(e){}
        }, 1500);
      });
    };
  </script>
</head>

<body>
  <div id="container"></div>
</body>
</html>
